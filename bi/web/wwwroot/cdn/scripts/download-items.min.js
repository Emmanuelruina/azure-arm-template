var isFreshLoad=!0,downloadDashboardProcessStatusInfo="",isDownoadItemStatusDialogBinded=!1,objectSelected=[],validData=[],successtext="Success";function onStatusClick(){ejs.popups.showSpinner(document.getElementById("download_item_status"));var e=document.getElementById("ProgressStages");$("#DownlodDashboardStatus").html(e),$("#ProgressStages").show(),setTimeout(function(){var e=$("#DownloadItemGrid").data("ejGrid"),a=e.getCurrentViewData()[e.getIndexByRow($("#DownloadItemGrid .e-gridcontent tr.e-row[aria-selected *='true']"))];if($("#progress-stages").empty(),null!=a&&null!=a.Stages&&null!=a.Stages)for(i=0;i<a.Stages.length;i++)a.Stages[i].Status==DownloadandUploadJobStatus.InProgress?$("#progress-stages").append('<li class="col-xs-12 no-padding"><div class="loader-blue loader-icon col-xs-2 no-padding" id="upload-dashboard-progress-loader-icon"><svg class="circular"><circle class="path" cx="8" cy="8" r="6" fill="none" stroke-width="2" stroke-miterlimit="10"></circle></svg></div><span class="progress-info col-xs-10 no-padding">'+a.Stages[i].Label+"</span ></li >"):a.Stages[i].Status==DownloadandUploadJobStatus.Success?$("#progress-stages").append('<li class="col-xs-12 no-padding"><i class="su su-success col-xs-2 no-padding"><span class="su-success path1"></span><span class="su-success path2"></span></i><span class="progress-info col-xs-10 no-padding">'+a.Stages[i].Label+"</span ></li >"):a.Stages[i].Status==DownloadandUploadJobStatus.Failed?$("#progress-stages").append('<li class="col-xs-12 no-padding"><i class="su su-failure col-xs-2 no-padding"><span class="su-failure path1"></span><span class="su-failure path2"></span><span class="su-failure path3"></span><span class="su-failure path4"></span></i><span class="progress-info col-xs-10 no-padding">'+a.Stages[i].Label+'<span id="error-message" style="display: none;">'+a.Stages[i].ErrorMessage+'</span><span id="click-know-more">'+window.Server.App.Localization.KnowMore+"</span ></span ></li > "):a.Stages[i].Status==DownloadandUploadJobStatus.YetToStart&&$("#progress-stages").append('<li class="col-xs-12 no-padding"><i class="su su-schedule-status col-xs-2 no-padding yet-to-start"></i><span class="progress-info col-xs-10 no-padding">'+a.Stages[i].Label+"</span ></li >");e=document.getElementById("download_item_status").ej2_instances;e[0].header='<span class="dialog-header-with-subtitle"><span class ="dialog-header-title">'+window.Server.App.Localization.DownloadDashboard+'</span><span class="item-name">'+a.ItemName+"</span></span>",e[0].show()},50),ejs.popups.hideSpinner(document.getElementById("download_item_status"))}function closeStatusInfo(){downloadDashboardProcessStatusInfo.hide()}function pushUrl(e){isFreshLoad?(history.replaceState(e,null,window.location.pathname+"?tab="+e),isFreshLoad=!1):history.pushState(e,null,window.location.pathname+"?tab="+e)}function fnCreate(e){$("#checkbox-header").change(headCheckboxOnChange)}function headCheckboxOnChange(e){var a=0,t=$("#DownloadItemGrid").data("ejGrid");if(1==$("#checkbox-header").prop("checked")){$(".checkbox-row").each(function(){$(this).prop("disabled")||($(this).prop("checked",!0),a++)}),$(".dashboard-selected-count").text(window.Server.App.Localization.Selected.format(a)),$("#bulk-download").attr("disabled",!1),t.multiSelectCtrlRequest=!0,t.selectRows(0,$(".checkbox-row").length+$(".checkbox-row-disabled").length);for(var o=0;o<$(".checkbox-row-disabled").length;o++){var s=$(".checkbox-row-disabled"),s=$($(s[o]).closest("td").parent()).index();t.selectRows(s)}objectSelected=[],objectSelected=$.extend(!0,objectSelected,searchdata.result),isSafari&&$(".checkbox-header-label").addClass("check")}else $(".checkbox-row").prop("checked",!1),objectSelected=[],t.clearSelection(),isSafari&&$(".checkbox-header-label").removeClass("check"),$(".dashboard-selected-count").text("Selected ("+a+")"),$("#bulk-download").attr("disabled",!0)}function setHeaderCheckedStatus(e){null!=e.getRows()&&(validData.length===objectSelected.length&&0<objectSelected.length?$("#checkbox-header").prop("checked",!0):$("#checkbox-header").prop("checked",!1))}function fnOnUserGridActionComplete(e){var a=$("#DownloadItemGrid").data("ejGrid"),t=($("#checkbox-header").prop("enabled",!1),$("#checkbox-header").change(headCheckboxOnChange),a.multiSelectCtrlRequest=!0,a.clearSelection(),$('[data-toggle="tooltip"]').tooltip(),showOrHideGridPager("#DownloadItemGrid"),a.model.query.queries),o=t.map(function(e,a){return e.fn}),s=(t.splice(o.indexOf("onPage"),1),searchdata=new ej.DataManager(a.model.currentViewData).executeLocal(a.model.query),validData=$.grep(searchdata.result,function(e){return e.Status==successtext}),[]);if($.map(searchdata.result,function(e){-1!=jQuery.inArray(JSON.stringify(e),$.map(objectSelected,JSON.stringify))&&s.push(e)}),objectSelected=[],objectSelected=$.extend(!0,objectSelected,s),"paging"==e.requestType||"sorting"==e.requestType||"refresh"==e.requestType||"filtering"==e.requestType||"searching"==e.requestType){for(var n=0;n<a.model.currentViewData.length;n++){var d=a.model.currentViewData[n],r=d.UserId;-1!=jQuery.inArray(JSON.stringify(d),$.map(objectSelected,JSON.stringify))&&($("#user_grid .checkbox-row#row-check"+r).prop("checked",!0),a.selectRows($($("#user_grid .checkbox-row#row-check"+r).closest("td").parent()).index()))}0!=objectSelected.length&&objectSelected.length===searchdata.result.length?$("#checkbox-header").prop("enabled",!0):$("#checkbox-header").prop("enabled",!1)}}function fnRecordClick(e){var a,t;e.columnName!=window.Server.App.Localization.DownloadItemStatus&&(a=$("#DownloadItemGrid").data("ejGrid"),e.row.find(".checkbox-row").is(":checked")?(a.multiSelectCtrlRequest=!0,-1==jQuery.inArray(JSON.stringify(e.data),$.map(objectSelected,JSON.stringify))?objectSelected.push(e.data):a.selectRows(e.row.index())):(a.multiSelectCtrlRequest=!0,a.selectRows(e.row.index()),-1!=(t=jQuery.inArray(JSON.stringify(e.data),$.map(objectSelected,JSON.stringify)))&&(objectSelected.splice(t,1),a.selectRows(e.row.index()))),setHeaderCheckedStatus(a))}$(document).ready(function(){var e,a,t='<span class="dialog-header-with-subtitle"><span class ="dialog-header-title">'+window.Server.App.Localization.DownloadDashboard+'</span><span class="item-name"></span></span>';isDownoadItemStatusDialogBinded?((a=document.getElementById("download_item_status").ej2_instances)[0].header=t,a[0].show()):((e=document.createElement("div")).setAttribute("id","download_item_status"),document.getElementById("base-container").appendChild(e),(a=new ejs.popups.Dialog({showOnInit:!1,visible:!1,allowDraggable:!1,enableResize:!1,width:460<window.innerWidth?"456px":window.innerWidth-10,height:"auto",showHeader:!1,isModal:!0,enableModal:!0,closeOnEscape:!0,header:t,showCloseIcon:!0,content:document.getElementById("DownlodDashboardStatus"),buttons:[{click:function(){a.hide(),$("#DownloadItemGrid").data("ejGrid").clearSelection()},buttonModel:{isPrimary:!0,cssClass:"app-btn-primary",content:window.Server.App.Localization.OKButton}}]})).appendTo(e),isDownoadItemStatusDialogBinded=!0),ejs.popups.createSpinner({target:document.getElementById("download_item_status")}),ejs.popups.setSpinner({type:"Material"})}),$(document).on("click","#click-know-more",function(){$(this).parent().find("#error-message").is(":visible")?($(this).parent().find("#error-message").hide(),$(this).text(window.Server.App.Localization.KnowMore)):($(this).parent().find("#error-message").show(),$(this).text(window.Server.App.Localization.KnowLess))}),$(document).on("click","#clear-downloadfiles-search",function(){var e=$(this).prevAll("input"),a="#"+(e=""==e||null==e||e.length<=0?$(this).prev("div").find("input"):e).attr("id");e.val(""),$("#clear-downloadfiles-search").css("display","none"),""==e.val()&&(PerformSearch(a),$("#clear-downloadfiles-search").siblings("span.su-search").css("display","block"))}),$(document).on("click",'a[data-toggle="tab"]',function(e){pushUrl($(e.target).attr("href").replace("#",""))}),$(document).on("click",'#DownloadItemGrid input[type="checkbox"]',function(){var e=$("#DownloadItemGrid .checkbox-row:checked").length;$(".dashboard-selected-count").text(window.Server.App.Localization.Selected.format(e)),1<e?$("#bulk-download").attr("disabled",!1):$("#bulk-download").attr("disabled",!0)}),$(document).on("click","#bulk-download",function(e){for(var a=[],t=$("#DownloadItemGrid").data("ejGrid"),o=t.getSelectedRecords(),a=[],s=0;s<o.length;s++)null!=o[s]&&a.push({JobId:o[s].JobId,ItemId:o[s].ItemId,Name:o[s].ItemName});ejs.popups.createSpinner({target:document.getElementById("server-app-container")}),ejs.popups.setSpinner({type:"Material"}),ejs.popups.showSpinner(document.getElementById("server-app-container")),$.ajax({type:"POST",url:bulkDownloadUrl,data:{data:JSON.stringify(a)},xhrFields:{responseType:"blob"},success:function(e){var a=document.createElement("a"),e=window.URL.createObjectURL(e);a.href=e,a.download="dashboard collection.zip",document.body.append(a),a.click(),a.remove(),window.URL.revokeObjectURL(e),$(".checkbox-row").prop("checked",!1),$("#checkbox-header").prop("checked",!1),$("#bulk-download").attr("disabled",!0),objectSelected=[],$(".dashboard-selected-count").text(window.Server.App.Localization.Selected.format(0)),t.clearSelection(),ejs.popups.hideSpinner(document.getElementById("server-app-container"))}})});